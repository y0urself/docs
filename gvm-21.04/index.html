
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Building GVM 21.04 &#8212; Greenbone Documentation  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.gif"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Building GVM 20.08" href="../gvm-20.08/index.html" />
    <link rel="prev" title="Background" href="../background.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="building-gvm-21-04">
<h1>Building GVM 21.04<a class="headerlink" href="#building-gvm-21-04" title="Permalink to this headline">¶</a></h1>
<p>Building the GVM stack from source requires knowledge about:</p>
<ul class="simple">
<li><p>Using a terminal</p></li>
<li><p>Shell programming basic</p></li>
<li><p>Installing software via <em>apt</em></p></li>
<li><p>Using a C compiler</p></li>
<li><p>Using <em>CMake</em> and <em>make</em></p></li>
<li><p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Linux File System Hierarchy</a></p></li>
<li><p>Running services via <em>systemd</em></p></li>
</ul>
<p>Additionally, a basic knowledge about the <a class="reference internal" href="../architecture.html"><span class="doc">GVM architecture</span></a>
is required to follow this guide.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This guide is intended for developers who want to try out the newest features
and/or want to get familiar with the source code. It is not intended for
production setups.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#prerequisites" id="id81">Prerequisites</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-a-user-and-a-group" id="id82">Creating a User and a Group</a></p></li>
<li><p><a class="reference internal" href="#adjusting-the-current-user" id="id83">Adjusting the Current User</a></p></li>
<li><p><a class="reference internal" href="#setting-the-path" id="id84">Setting the PATH</a></p></li>
<li><p><a class="reference internal" href="#choosing-an-install-prefix" id="id85">Choosing an Install Prefix</a></p></li>
<li><p><a class="reference internal" href="#creating-a-source-build-and-install-directory" id="id86">Creating a Source, Build and Install Directory</a></p></li>
<li><p><a class="reference internal" href="#choosing-the-installation-source" id="id87">Choosing the Installation Source</a></p></li>
<li><p><a class="reference internal" href="#installing-common-build-dependencies" id="id88">Installing Common Build Dependencies</a></p></li>
<li><p><a class="reference internal" href="#importing-the-greenbone-signing-key" id="id89">Importing the Greenbone Signing Key</a></p></li>
<li><p><a class="reference internal" href="#setting-the-version" id="id90">Setting the version</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-and-installing-the-components" id="id91">Building and Installing the Components</a></p>
<ul>
<li><p><a class="reference internal" href="#gvm-libs" id="id92">gvm-libs</a></p></li>
<li><p><a class="reference internal" href="#gvmd" id="id93">gvmd</a></p></li>
<li><p><a class="reference internal" href="#gsa" id="id94">GSA</a></p></li>
<li><p><a class="reference internal" href="#openvas-smb" id="id95">openvas-smb</a></p></li>
<li><p><a class="reference internal" href="#openvas-scanner" id="id96">openvas-scanner</a></p></li>
<li><p><a class="reference internal" href="#ospd-openvas" id="id97">ospd-openvas</a></p></li>
<li><p><a class="reference internal" href="#gvm-tools" id="id98">gvm-tools</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performing-a-system-setup-for-gvm" id="id99">Performing a System Setup for GVM</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-up-the-redis-data-store" id="id100">Setting up the Redis Data Store</a></p></li>
<li><p><a class="reference internal" href="#adjusting-permissions" id="id101">Adjusting Permissions</a></p></li>
<li><p><a class="reference internal" href="#setting-up-sudo-for-scanning" id="id102">Setting up <em>sudo</em> for Scanning</a></p></li>
<li><p><a class="reference internal" href="#setting-up-postgresql" id="id103">Setting up PostgreSQL</a></p></li>
<li><p><a class="reference internal" href="#setting-up-an-admin-user" id="id104">Setting up an Admin User</a></p></li>
<li><p><a class="reference internal" href="#setting-the-feed-import-owner" id="id105">Setting the Feed Import Owner</a></p></li>
<li><p><a class="reference internal" href="#performing-an-initial-feed-synchronization" id="id106">Performing an Initial Feed Synchronization</a></p></li>
<li><p><a class="reference internal" href="#starting-services-with-systemd" id="id107">Starting Services with <em>Systemd</em></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#starting-the-vulnerability-management" id="id108">Starting the Vulnerability Management</a></p></li>
</ul>
</div>
<p>This guide assumes that Debian Stable (Buster) is used as the Linux
distribution. Most likely, a Debian derivate like Ubuntu and Kali will
also work with only minor adjustments required.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">sudo</span></code> is used for executing commands that require privileged
access on the system.</p>
<section id="prerequisites">
<h2><a class="toc-backref" href="#id81">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the guide step by step. Later steps might require settings or
output of a previous command.</p>
</div>
<section id="creating-a-user-and-a-group">
<h3><a class="toc-backref" href="#id82">Creating a User and a Group</a><a class="headerlink" href="#creating-a-user-and-a-group" title="Permalink to this headline">¶</a></h3>
<p>The services provided by the GVM framework should run as a dedicated user and
group. Therefore a <cite>gvm</cite> user and a group with the same name will be created.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Creating a gvm system user and group</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo useradd -r -M -U -G sudo -s /usr/sbin/nologin gvm</span>
</pre></div>
</div>
</div>
</section>
<section id="adjusting-the-current-user">
<h3><a class="toc-backref" href="#id83">Adjusting the Current User</a><a class="headerlink" href="#adjusting-the-current-user" title="Permalink to this headline">¶</a></h3>
<p>To allow the current user to run <em>gvmd</em> he must be added to the <em>gvm</em> group.
To make the group change effective either logout and login again or use
<strong class="command">su</strong>.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Add current user to gvm group</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo usermod -aG gvm $USER</span>

<span class="go">su $USER</span>
</pre></div>
</div>
</div>
</section>
<section id="setting-the-path">
<h3><a class="toc-backref" href="#id84">Setting the PATH</a><a class="headerlink" href="#setting-the-path" title="Permalink to this headline">¶</a></h3>
<p>On Debian systems the locations <code class="file docutils literal notranslate"><span class="pre">/sbin</span></code>, <code class="file docutils literal notranslate"><span class="pre">/usr/sbin</span></code> and
<code class="file docutils literal notranslate"><span class="pre">/usr/local/sbin</span></code> are not in the <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> of normal users. To run
<em>gvmd</em> which is located in <code class="file docutils literal notranslate"><span class="pre">/usr/local/sbin</span></code> the <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>
environment variable should be adjusted.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Adjusting PATH for running gvmd</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export PATH=$PATH:/usr/local/sbin</span>
</pre></div>
</div>
</div>
</section>
<section id="choosing-an-install-prefix">
<h3><a class="toc-backref" href="#id85">Choosing an Install Prefix</a><a class="headerlink" href="#choosing-an-install-prefix" title="Permalink to this headline">¶</a></h3>
<p>Before building the software stack, a (root) directory must be chosen where
the built software will finally be installed. For example, when building packages,
the distribution developers set this path to <cite>/usr</cite>.</p>
<p>By default, it is <code class="file docutils literal notranslate"><span class="pre">/usr/local</span></code> which is also used in this guide. This
directory will be stored in an environment variable <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">INSTALL_PREFIX</span></code>
to be able to reference it later.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Setting an install prefix environment variable</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export INSTALL_PREFIX=/usr/local</span>
</pre></div>
</div>
</div>
</section>
<section id="creating-a-source-build-and-install-directory">
<h3><a class="toc-backref" href="#id86">Creating a Source, Build and Install Directory</a><a class="headerlink" href="#creating-a-source-build-and-install-directory" title="Permalink to this headline">¶</a></h3>
<p>To separate the sources and the build artifacts, a source and a build directory
must be created.</p>
<p>This source directory will be used later in this guide via
an environment variable <span class="target" id="index-3"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">SOURCE_DIR</span></code>. Accordingly, a variable
<span class="target" id="index-4"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">BUILD_DIR</span></code> will be set for the build directory. Both can be set to any
directory to which the current user has write permissions. Therefore
directories in the current user’s home directory are chosen in this guide.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Choosing a source directory</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export SOURCE_DIR=$HOME/source</span>
<span class="go">mkdir -p $SOURCE_DIR</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Choosing a build directory</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export BUILD_DIR=$HOME/build</span>
<span class="go">mkdir -p $BUILD_DIR</span>
</pre></div>
</div>
</div>
<p>Additionally, an install directory will be set as an environment variable
<span class="target" id="index-5"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">INSTALL_DIR</span></code>. It is used as a temporary installation directory
before moving all built artifacts to the final destination.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Choosing a temporary install directory</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export INSTALL_DIR=$HOME/install</span>
<span class="go">mkdir -p $INSTALL_DIR</span>
</pre></div>
</div>
</div>
</section>
<section id="choosing-the-installation-source">
<h3><a class="toc-backref" href="#id87">Choosing the Installation Source</a><a class="headerlink" href="#choosing-the-installation-source" title="Permalink to this headline">¶</a></h3>
<p>For building the GVM software stack, three different sources can be chosen
depending on the desired stability:</p>
<ul class="simple">
<li><p>Building from release <a class="reference external" href="https://en.wikipedia.org/wiki/Tar_(computing)">tarballs</a></p></li>
<li><p>Building from git tags</p></li>
<li><p>Building from release branches</p></li>
</ul>
<p>Linux distributions use the release <a class="reference external" href="https://en.wikipedia.org/wiki/Tar_(computing)">tarballs</a> because it is the most common
and well known method to share source code.</p>
<p>Newer build systems may stick with the git tags.</p>
<p>If you are a developer and very familiar with building from source already, you
may also try out using the git release branches. These have the
advantage that they contain the newest fixes which may not yet be included in the
release tarballs or git tags. As a downside, the release branches may
contain only partially fixed issues and need to be updated more often.</p>
<p>This guide will use the tarballs to build the software.</p>
</section>
<section id="installing-common-build-dependencies">
<h3><a class="toc-backref" href="#id88">Installing Common Build Dependencies</a><a class="headerlink" href="#installing-common-build-dependencies" title="Permalink to this headline">¶</a></h3>
<p>For downloading, configuring, building and installing the <a class="reference internal" href="../glossary.html#term-GVM"><span class="xref std std-term">GVM</span></a> components,
several tools and applications are required. To install this requirements via
<em>apt</em>, the following command can be used:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Installing common build dependencies</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt update</span>
<span class="go">sudo apt install --no-install-recommends --assume-yes \</span>
<span class="go">  build-essential \</span>
<span class="go">  curl \</span>
<span class="go">  cmake \</span>
<span class="go">  pkg-config \</span>
<span class="go">  python3 \</span>
<span class="go">  python3-pip \</span>
<span class="go">  gnupg</span>
</pre></div>
</div>
</div>
</section>
<section id="importing-the-greenbone-signing-key">
<h3><a class="toc-backref" href="#id89">Importing the Greenbone Signing Key</a><a class="headerlink" href="#importing-the-greenbone-signing-key" title="Permalink to this headline">¶</a></h3>
<p>To validate the integrity of the downloaded source files,
<a class="reference external" href="https://www.gnu.org/">GnuPG</a> is used. It requires downloading the
Greenbone Community Signing public key and importing it into the current user’s
keychain.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Importing the Greenbone Community Signing key</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">curl -O https://www.greenbone.net/GBCommunitySigningKey.asc</span>
<span class="go">gpg --import GBCommunitySigningKey.asc</span>
</pre></div>
</div>
</div>
<p>For understanding the validation output of the gpg tool, it is best to mark the
Greenbone Community Signing key as fully trusted.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Setting the trust level for the Greenbone Community Signing key</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg --edit-key 9823FAA60ED1E580

pub  rsa4096/9823FAA60ED1E580
   created: 2017-09-06  expires: never       usage: SC
   trust: unknown       validity: unknown
[ unknown] (1). Greenbone Community Feed integrity key

gpg&gt; trust

pub  rsa4096/9823FAA60ED1E580
   created: 2017-09-06  expires: never       usage: SC
   trust: unknown       validity: unknown
[ unknown] (1). Greenbone Community Feed integrity key

Please decide how far you trust this user to correctly verify other users&#39; keys
(by looking at passports, checking fingerprints from different sources, etc.)

  1 = I don&#39;t know or won&#39;t say
  2 = I do NOT trust
  3 = I trust marginally
  4 = I trust fully
  5 = I trust ultimately
  m = back to the main menu

Your decision? 5
Do you really want to set this key to ultimate trust? (y/N) y

pub  rsa4096/9823FAA60ED1E580
   created: 2017-09-06  expires: never       usage: SC
   trust: ultimate      validity: ultimate
[ultimate] (1). Greenbone Community Feed integrity key

gpg&gt; quit
</pre></div>
</div>
</div>
</section>
<section id="setting-the-version">
<h3><a class="toc-backref" href="#id90">Setting the version</a><a class="headerlink" href="#setting-the-version" title="Permalink to this headline">¶</a></h3>
<p>To make the downloading easier, an environment variable for the desired release
version will be set. Using a variable allows adjusting the version easily after
a new release.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Setting a GVM version as environment variable</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export GVM_VERSION=21.4.3</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="building-and-installing-the-components">
<h2><a class="toc-backref" href="#id91">Building and Installing the Components</a><a class="headerlink" href="#building-and-installing-the-components" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The components should be build and installed in the listed order.</p>
</div>
<section id="gvm-libs">
<h3><a class="toc-backref" href="#id92">gvm-libs</a><a class="headerlink" href="#gvm-libs" title="Permalink to this headline">¶</a></h3>
<p><em>gvm-libs</em> is a C library providing basic functionality like XML parsing and
network communication. It is used in <em>openvas-scanner</em>, <em>gvmd</em> and <em>gsad</em>.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Setting the gvm-libs version to use</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export GVM_LIBS_VERSION=$GVM_VERSION</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">Required dependencies for gvm-libs</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  libglib2.0-dev \</span>
<span class="go">  libgpgme-dev \</span>
<span class="go">  libgnutls28-dev \</span>
<span class="go">  uuid-dev \</span>
<span class="go">  libssh-gcrypt-dev \</span>
<span class="go">  libhiredis-dev \</span>
<span class="go">  libxml2-dev \</span>
<span class="go">  libpcap-dev \</span>
<span class="go">  libnet1-dev</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">Optional dependencies for gvm-libs</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  libldap2-dev \</span>
<span class="go">  libradcli-dev</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">Downloading the gvm-libs sources</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">curl -f -L https://github.com/greenbone/gvm-libs/archive/refs/tags/v$GVM_LIBS_VERSION.tar.gz -o $SOURCE_DIR/gvm-libs-$GVM_LIBS_VERSION.tar.gz</span>
<span class="go">curl -f -L https://github.com/greenbone/gvm-libs/releases/download/v$GVM_LIBS_VERSION/gvm-libs-$GVM_LIBS_VERSION.tar.gz.asc -o $SOURCE_DIR/gvm-libs-$GVM_LIBS_VERSION.tar.gz.asc</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">Verifying the source file</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">gpg --verify $SOURCE_DIR/gvm-libs-$GVM_LIBS_VERSION.tar.gz.asc $SOURCE_DIR/gvm-libs-$GVM_LIBS_VERSION.tar.gz</span>
</pre></div>
</div>
</div>
<p>The output of the last command should be similar to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg: Signature made Fri Apr 16 08:31:02 2021 UTC
gpg:                using RSA key 9823FAA60ED1E580
gpg: Good signature from &quot;Greenbone Community Feed integrity key&quot; [ultimate]
</pre></div>
</div>
<p>If the signature is valid, the tarball can be extracted.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">tar -C $SOURCE_DIR -xvzf $SOURCE_DIR/gvm-libs-$GVM_LIBS_VERSION.tar.gz</span>
</pre></div>
</div>
<p>Afterwards, gvm-libs can be build and installed.</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">Building gvm-libs</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p $BUILD_DIR/gvm-libs &amp;&amp; cd $BUILD_DIR/gvm-libs</span>

<span class="go">cmake $SOURCE_DIR/gvm-libs-$GVM_LIBS_VERSION \</span>
<span class="go">  -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \</span>
<span class="go">  -DCMAKE_BUILD_TYPE=Release \</span>
<span class="go">  -DSYSCONFDIR=/etc \</span>
<span class="go">  -DLOCALSTATEDIR=/var \</span>
<span class="go">  -DGVM_PID_DIR=/run/gvm</span>

<span class="go">make -j$(nproc)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">Installing gvm-libs</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">make DESTDIR=$INSTALL_DIR install</span>

<span class="go">sudo cp -rv $INSTALL_DIR/* /</span>

<span class="go">rm -rf $INSTALL_DIR/*</span>
</pre></div>
</div>
</div>
</section>
<section id="gvmd">
<h3><a class="toc-backref" href="#id93">gvmd</a><a class="headerlink" href="#gvmd" title="Permalink to this headline">¶</a></h3>
<p>The Greenbone Vulnerability Management Daemon (gvmd) is the main service of the
current GVM stack. It handles authentication, scan management, vulnerability
information, reporting, alerting, scheduling and much more. As a storage backend,
it uses a PostgreSQL database.</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">Setting the gvmd version to use</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export GVMD_VERSION=21.4.4</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">Required dependencies for gvmd</span><a class="headerlink" href="#id21" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  libglib2.0-dev \</span>
<span class="go">  libgnutls28-dev \</span>
<span class="go">  libpq-dev \</span>
<span class="go">  postgresql-server-dev-11 \</span>
<span class="go">  libical-dev \</span>
<span class="go">  xsltproc \</span>
<span class="go">  rsync</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">Optional dependencies for gvmd</span><a class="headerlink" href="#id22" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y --no-install-recommends \</span>
<span class="go">  texlive-latex-extra \</span>
<span class="go">  texlive-fonts-recommended \</span>
<span class="go">  xmlstarlet \</span>
<span class="go">  zip \</span>
<span class="go">  rpm \</span>
<span class="go">  fakeroot \</span>
<span class="go">  dpkg \</span>
<span class="go">  nsis \</span>
<span class="go">  gnupg \</span>
<span class="go">  gpgsm \</span>
<span class="go">  wget \</span>
<span class="go">  sshpass \</span>
<span class="go">  openssh-client \</span>
<span class="go">  socat \</span>
<span class="go">  snmp \</span>
<span class="go">  python3 \</span>
<span class="go">  smbclient \</span>
<span class="go">  python3-lxml \</span>
<span class="go">  gnutls-bin \</span>
<span class="go">  xml-twig-tools</span>
</pre></div>
</div>
</div>
<p>Details about the optional dependencies can be found at
<a class="reference external" href="https://github.com/greenbone/gvmd/blob/gvmd-21.04/INSTALL.md#prerequisites-for-optional-features">https://github.com/greenbone/gvmd/blob/gvmd-21.04/INSTALL.md#prerequisites-for-optional-features</a></p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">Downloading the gvmd sources</span><a class="headerlink" href="#id23" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">curl -f -L https://github.com/greenbone/gvmd/archive/refs/tags/v$GVMD_VERSION.tar.gz -o $SOURCE_DIR/gvmd-$GVMD_VERSION.tar.gz</span>
<span class="go">curl -f -L https://github.com/greenbone/gvmd/releases/download/v$GVMD_VERSION/gvmd-$GVMD_VERSION.tar.gz.asc -o $SOURCE_DIR/gvmd-$GVMD_VERSION.tar.gz.asc</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">Verifying the source file</span><a class="headerlink" href="#id24" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">gpg --verify $SOURCE_DIR/gvmd-$GVMD_VERSION.tar.gz.asc $SOURCE_DIR/gvmd-$GVMD_VERSION.tar.gz</span>
</pre></div>
</div>
</div>
<p>The output of the last command should be similar to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg: Signature made Fri Apr 16 08:31:02 2021 UTC
gpg:                using RSA key 9823FAA60ED1E580
gpg: Good signature from &quot;Greenbone Community Feed integrity key&quot; [ultimate]
</pre></div>
</div>
<p>If the signature is valid the tarball can be extracted.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">tar -C $SOURCE_DIR -xvzf $SOURCE_DIR/gvmd-$GVMD_VERSION.tar.gz</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">Building gvmd</span><a class="headerlink" href="#id25" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p $BUILD_DIR/gvmd &amp;&amp; cd $BUILD_DIR/gvmd</span>

<span class="go">cmake $SOURCE_DIR/gvmd-$GVMD_VERSION \</span>
<span class="go">  -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \</span>
<span class="go">  -DCMAKE_BUILD_TYPE=Release \</span>
<span class="go">  -DLOCALSTATEDIR=/var \</span>
<span class="go">  -DSYSCONFDIR=/etc \</span>
<span class="go">  -DGVM_DATA_DIR=/var \</span>
<span class="go">  -DGVM_RUN_DIR=/run/gvm \</span>
<span class="go">  -DOPENVAS_DEFAULT_SOCKET=/run/ospd/ospd-openvas.sock \</span>
<span class="go">  -DGVM_FEED_LOCK_PATH=/var/lib/gvm/feed-update.lock \</span>
<span class="go">  -DSYSTEMD_SERVICE_DIR=/lib/systemd/system \</span>
<span class="go">  -DDEFAULT_CONFIG_DIR=/etc/default \</span>
<span class="go">  -DLOGROTATE_DIR=/etc/logrotate.d</span>

<span class="go">make -j$(nproc)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">Installing gvmd</span><a class="headerlink" href="#id26" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">make DESTDIR=$INSTALL_DIR install</span>

<span class="go">sudo cp -rv $INSTALL_DIR/* /</span>

<span class="go">rm -rf $INSTALL_DIR/*</span>
</pre></div>
</div>
</div>
</section>
<section id="gsa">
<h3><a class="toc-backref" href="#id94">GSA</a><a class="headerlink" href="#gsa" title="Permalink to this headline">¶</a></h3>
<p>The Greenbone Security Assistant (GSA) sources consist of two parts:</p>
<ul class="simple">
<li><p>Web server <em>gsad</em></p></li>
<li><p>Web application <em>GSA</em></p></li>
</ul>
<p>The web server <em>gsad</em> is written in the C programming language. It serves
static content like images and provides an API for the web application.
Internally it communicates with <em>gvmd</em> using <a class="reference internal" href="../glossary.html#term-GMP"><span class="xref std std-term">GMP</span></a>.</p>
<p>The web application is written in JavaScript and uses the
<a class="reference external" href="https://reactjs.org/">react framework</a>. It requires
<a class="reference external" href="https://nodejs.org/">nodejs</a> for building the application and <em>yarn</em> (or <em>npm</em>)
for maintaining the JavaScript dependencies.</p>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">Setting the GSA version to use</span><a class="headerlink" href="#id27" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export GSA_VERSION=$GVM_VERSION</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text">Required dependencies for gsad</span><a class="headerlink" href="#id28" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  libmicrohttpd-dev \</span>
<span class="go">  libxml2-dev \</span>
<span class="go">  libglib2.0-dev \</span>
<span class="go">  libgnutls28-dev</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-text">Required dependencies for GSA</span><a class="headerlink" href="#id29" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  nodejs \</span>
<span class="go">  yarnpkg</span>
</pre></div>
</div>
</div>
<p>Building the web application GSA requires the installation of several JavaScript
dependencies. These dependencies have to be downloaded automatically by <em>yarn</em>
(or <em>npm</em>) during the build process.</p>
<div class="literal-block-wrapper docutils container" id="id30">
<div class="code-block-caption"><span class="caption-text">Downloading the gsa sources</span><a class="headerlink" href="#id30" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">curl -f -L https://github.com/greenbone/gsa/archive/refs/tags/v$GSA_VERSION.tar.gz -o $SOURCE_DIR/gsa-$GSA_VERSION.tar.gz</span>
<span class="go">curl -f -L https://github.com/greenbone/gsa/releases/download/v$GSA_VERSION/gsa-$GSA_VERSION.tar.gz.asc -o $SOURCE_DIR/gsa-$GSA_VERSION.tar.gz.asc</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id31">
<div class="code-block-caption"><span class="caption-text">Verifying the source files</span><a class="headerlink" href="#id31" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">gpg --verify $SOURCE_DIR/gsa-$GSA_VERSION.tar.gz.asc $SOURCE_DIR/gsa-$GSA_VERSION.tar.gz</span>
</pre></div>
</div>
</div>
<p>The output of both commands should be similar to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg: Signature made Fri Apr 16 08:31:02 2021 UTC
gpg:                using RSA key 9823FAA60ED1E580
gpg: Good signature from &quot;Greenbone Community Feed integrity key&quot; [ultimate]
</pre></div>
</div>
<p>If the signatures are valid, the two tarballs can be extracted.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">tar -C $SOURCE_DIR -xvzf $SOURCE_DIR/gsa-$GSA_VERSION.tar.gz</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id32">
<div class="code-block-caption"><span class="caption-text">Building gsa</span><a class="headerlink" href="#id32" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p $BUILD_DIR/gsa &amp;&amp; cd $BUILD_DIR/gsa</span>

<span class="go">cmake $SOURCE_DIR/gsa-$GSA_VERSION \</span>
<span class="go">  -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \</span>
<span class="go">  -DCMAKE_BUILD_TYPE=Release \</span>
<span class="go">  -DSYSCONFDIR=/etc \</span>
<span class="go">  -DLOCALSTATEDIR=/var \</span>
<span class="go">  -DGVM_RUN_DIR=/run/gvm \</span>
<span class="go">  -DGSAD_PID_DIR=/run/gvm \</span>
<span class="go">  -DLOGROTATE_DIR=/etc/logrotate.d</span>

<span class="go">make -j$(nproc)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id33">
<div class="code-block-caption"><span class="caption-text">Installing gsa</span><a class="headerlink" href="#id33" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">make DESTDIR=$INSTALL_DIR install</span>

<span class="go">sudo cp -rv $INSTALL_DIR/* /</span>

<span class="go">rm -rf $INSTALL_DIR/*</span>
</pre></div>
</div>
</div>
</section>
<section id="openvas-smb">
<h3><a class="toc-backref" href="#id95">openvas-smb</a><a class="headerlink" href="#openvas-smb" title="Permalink to this headline">¶</a></h3>
<p><em>openvas-smb</em> is a helper module for <em>openvas-scanner</em>. It includes libraries
(openvas-wmiclient/openvas-wincmd) to interface with Microsoft Windows Systems
through the Windows Management Instrumentation API and a winexe binary to
execute processes remotely on that system.</p>
<p>It is an optional dependency of <em>openvas-scanner</em> but is required for scanning
Windows-based systems.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>openvas-smb</em> is released independently of the GVM framework. Therefore, the
newest compatible version is used.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-text">Required dependencies for openvas-smb</span><a class="headerlink" href="#id34" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  gcc-mingw-w64 \</span>
<span class="go">  libgnutls28-dev \</span>
<span class="go">  libglib2.0-dev \</span>
<span class="go">  libpopt-dev \</span>
<span class="go">  libunistring-dev \</span>
<span class="go">  heimdal-dev \</span>
<span class="go">  perl-base</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-text">Setting the openvas-smb version to use</span><a class="headerlink" href="#id35" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export OPENVAS_SMB_VERSION=21.4.0</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-text">Downloading the openvas-smb sources</span><a class="headerlink" href="#id36" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">curl -f -L https://github.com/greenbone/openvas-smb/archive/refs/tags/v$OPENVAS_SMB_VERSION.tar.gz -o $SOURCE_DIR/openvas-smb-$OPENVAS_SMB_VERSION.tar.gz</span>
<span class="go">curl -f -L https://github.com/greenbone/openvas-smb/releases/download/v$OPENVAS_SMB_VERSION/openvas-smb-$OPENVAS_SMB_VERSION.tar.gz.asc -o $SOURCE_DIR/openvas-smb-$OPENVAS_SMB_VERSION.tar.gz.asc</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id37">
<div class="code-block-caption"><span class="caption-text">Verifying the source file</span><a class="headerlink" href="#id37" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">gpg --verify $SOURCE_DIR/openvas-smb-$OPENVAS_SMB_VERSION.tar.gz.asc $SOURCE_DIR/openvas-smb-$OPENVAS_SMB_VERSION.tar.gz</span>
</pre></div>
</div>
</div>
<p>The output of the last command should be similar to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg: Signature made Fri Apr 16 08:31:02 2021 UTC
gpg:                using RSA key 9823FAA60ED1E580
gpg: Good signature from &quot;Greenbone Community Feed integrity key&quot; [ultimate]
</pre></div>
</div>
<p>If the signature is valid, the tarball can be extracted.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">tar -C $SOURCE_DIR -xvzf $SOURCE_DIR/openvas-smb-$OPENVAS_SMB_VERSION.tar.gz</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-text">Building openvas-smb</span><a class="headerlink" href="#id38" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p $BUILD_DIR/openvas-smb &amp;&amp; cd $BUILD_DIR/openvas-smb</span>

<span class="go">cmake $SOURCE_DIR/openvas-smb-$OPENVAS_SMB_VERSION \</span>
<span class="go">  -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \</span>
<span class="go">  -DCMAKE_BUILD_TYPE=Release</span>

<span class="go">make -j$(nproc)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-text">Installing openvas-smb</span><a class="headerlink" href="#id39" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">make DESTDIR=$INSTALL_DIR install</span>

<span class="go">sudo cp -rv $INSTALL_DIR/* /</span>

<span class="go">rm -rf $INSTALL_DIR/*</span>
</pre></div>
</div>
</div>
</section>
<section id="openvas-scanner">
<h3><a class="toc-backref" href="#id96">openvas-scanner</a><a class="headerlink" href="#openvas-scanner" title="Permalink to this headline">¶</a></h3>
<p><em>openvas-scanner</em> is a full-featured scan engine that executes a continuously
updated and extended feed of <a class="reference internal" href="../glossary.html#term-VT"><span class="xref std std-term">Vulnerability Tests (VTs)</span></a>. The feed consist of
thousands of NASL (Network Attack Scripting Language) scripts which implement
all kind of vulnerability checks.</p>
<div class="literal-block-wrapper docutils container" id="id40">
<div class="code-block-caption"><span class="caption-text">Setting the openvas-scanner version to use</span><a class="headerlink" href="#id40" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export OPENVAS_SCANNER_VERSION=$GVM_VERSION</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id41">
<div class="code-block-caption"><span class="caption-text">Required dependencies for openvas-scanner</span><a class="headerlink" href="#id41" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  bison \</span>
<span class="go">  libglib2.0-dev \</span>
<span class="go">  libgnutls28-dev \</span>
<span class="go">  libgcrypt20-dev \</span>
<span class="go">  libpcap-dev \</span>
<span class="go">  libgpgme-dev \</span>
<span class="go">  libksba-dev \</span>
<span class="go">  rsync \</span>
<span class="go">  nmap</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id42">
<div class="code-block-caption"><span class="caption-text">Optional dependencies for openvas-scanner</span><a class="headerlink" href="#id42" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  python-impacket \</span>
<span class="go">  libsnmp-dev</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id43">
<div class="code-block-caption"><span class="caption-text">Downloading the openvas-scanner sources</span><a class="headerlink" href="#id43" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">curl -f -L https://github.com/greenbone/openvas-scanner/archive/refs/tags/v$OPENVAS_SCANNER_VERSION.tar.gz -o $SOURCE_DIR/openvas-scanner-$OPENVAS_SCANNER_VERSION.tar.gz</span>
<span class="go">curl -f -L https://github.com/greenbone/openvas-scanner/releases/download/v$OPENVAS_SCANNER_VERSION/openvas-scanner-$OPENVAS_SCANNER_VERSION.tar.gz.asc -o $SOURCE_DIR/openvas-scanner-$OPENVAS_SCANNER_VERSION.tar.gz.asc</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id44">
<div class="code-block-caption"><span class="caption-text">Verifying the source file</span><a class="headerlink" href="#id44" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">gpg --verify $SOURCE_DIR/openvas-scanner-$OPENVAS_SCANNER_VERSION.tar.gz.asc $SOURCE_DIR/openvas-scanner-$OPENVAS_SCANNER_VERSION.tar.gz</span>
</pre></div>
</div>
</div>
<p>The output of the last command should be similar to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg: Signature made Fri Apr 16 08:31:02 2021 UTC
gpg:                using RSA key 9823FAA60ED1E580
gpg: Good signature from &quot;Greenbone Community Feed integrity key&quot; [ultimate]
</pre></div>
</div>
<p>If the signature is valid, the tarball can be extracted.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">tar -C $SOURCE_DIR -xvzf $SOURCE_DIR/openvas-scanner-$OPENVAS_SCANNER_VERSION.tar.gz</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id45">
<div class="code-block-caption"><span class="caption-text">Building openvas-scanner</span><a class="headerlink" href="#id45" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p $BUILD_DIR/openvas-scanner &amp;&amp; cd $BUILD_DIR/openvas-scanner</span>

<span class="go">cmake $SOURCE_DIR/openvas-scanner-$OPENVAS_SCANNER_VERSION \</span>
<span class="go">  -DCMAKE_INSTALL_PREFIX=$INSTALL_PREFIX \</span>
<span class="go">  -DCMAKE_BUILD_TYPE=Release \</span>
<span class="go">  -DSYSCONFDIR=/etc \</span>
<span class="go">  -DLOCALSTATEDIR=/var \</span>
<span class="go">  -DOPENVAS_FEED_LOCK_PATH=/var/lib/openvas/feed-update.lock \</span>
<span class="go">  -DOPENVAS_RUN_DIR=/run/ospd</span>

<span class="go">make -j$(nproc)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id46">
<div class="code-block-caption"><span class="caption-text">Installing openvas-scanner</span><a class="headerlink" href="#id46" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">make DESTDIR=$INSTALL_DIR install</span>

<span class="go">sudo cp -rv $INSTALL_DIR/* /</span>

<span class="go">rm -rf $INSTALL_DIR/*</span>
</pre></div>
</div>
</div>
</section>
<section id="ospd-openvas">
<h3><a class="toc-backref" href="#id97">ospd-openvas</a><a class="headerlink" href="#ospd-openvas" title="Permalink to this headline">¶</a></h3>
<p><em>ospd-openvas</em> is an <a class="reference internal" href="../glossary.html#term-OSP"><span class="xref std std-term">OSP server</span></a> implementation to allow
<a class="reference internal" href="../glossary.html#term-GVM"><span class="xref std std-term">GVM</span></a> to remotely control an openvas-scanner. It is running as a daemon
and waits for incoming OSP requests from <em>gvmd</em>.</p>
<div class="literal-block-wrapper docutils container" id="id47">
<div class="code-block-caption"><span class="caption-text">Setting the ospd and ospd-openvas versions to use</span><a class="headerlink" href="#id47" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">export OSPD_VERSION=21.4.4</span>
<span class="go">export OSPD_OPENVAS_VERSION=$GVM_VERSION</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id48">
<div class="code-block-caption"><span class="caption-text">Required dependencies for ospd-openvas</span><a class="headerlink" href="#id48" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  python3 \</span>
<span class="go">  python3-pip \</span>
<span class="go">  python3-setuptools \</span>
<span class="go">  python3-packaging \</span>
<span class="go">  python3-wrapt \</span>
<span class="go">  python3-cffi \</span>
<span class="go">  python3-psutil \</span>
<span class="go">  python3-lxml \</span>
<span class="go">  python3-defusedxml \</span>
<span class="go">  python3-paramiko \</span>
<span class="go">  python3-redis</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id49">
<div class="code-block-caption"><span class="caption-text">Downloading the ospd sources</span><a class="headerlink" href="#id49" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">curl -f -L https://github.com/greenbone/ospd/archive/refs/tags/v$OSPD_VERSION.tar.gz -o $SOURCE_DIR/ospd-$OSPD_VERSION.tar.gz</span>
<span class="go">curl -f -L https://github.com/greenbone/ospd/releases/download/v$OSPD_VERSION/ospd-$OSPD_VERSION.tar.gz.asc -o $SOURCE_DIR/ospd-$OSPD_VERSION.tar.gz.asc</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id50">
<div class="code-block-caption"><span class="caption-text">Downloading the ospd-openvas sources</span><a class="headerlink" href="#id50" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">curl -f -L https://github.com/greenbone/ospd-openvas/archive/refs/tags/v$OSPD_OPENVAS_VERSION.tar.gz -o $SOURCE_DIR/ospd-openvas-$OSPD_OPENVAS_VERSION.tar.gz</span>
<span class="go">curl -f -L https://github.com/greenbone/ospd-openvas/releases/download/v$OSPD_OPENVAS_VERSION/ospd-openvas-$OSPD_OPENVAS_VERSION.tar.gz.asc -o $SOURCE_DIR/ospd-openvas-$OSPD_OPENVAS_VERSION.tar.gz.asc</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id51">
<div class="code-block-caption"><span class="caption-text">Verifying the source files</span><a class="headerlink" href="#id51" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">gpg --verify $SOURCE_DIR/ospd-$OSPD_VERSION.tar.gz.asc $SOURCE_DIR/ospd-$OSPD_VERSION.tar.gz</span>
<span class="go">gpg --verify $SOURCE_DIR/ospd-openvas-$OSPD_OPENVAS_VERSION.tar.gz.asc $SOURCE_DIR/ospd-openvas-$OSPD_OPENVAS_VERSION.tar.gz</span>
</pre></div>
</div>
</div>
<p>The output of the last command should be similar to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gpg: Signature made Fri Apr 16 08:31:02 2021 UTC
gpg:                using RSA key 9823FAA60ED1E580
gpg: Good signature from &quot;Greenbone Community Feed integrity key&quot; [ultimate]
</pre></div>
</div>
<p>If the signatures are valid, the tarballs can be extracted.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">tar -C $SOURCE_DIR -xvzf $SOURCE_DIR/ospd-$OSPD_VERSION.tar.gz</span>
<span class="go">tar -C $SOURCE_DIR -xvzf $SOURCE_DIR/ospd-openvas-$OSPD_OPENVAS_VERSION.tar.gz</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id52">
<div class="code-block-caption"><span class="caption-text">Installing ospd</span><a class="headerlink" href="#id52" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">cd $SOURCE_DIR/ospd-$OSPD_VERSION</span>

<span class="go">python3 -m pip install . --prefix=$INSTALL_PREFIX --root=$INSTALL_DIR</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id53">
<div class="code-block-caption"><span class="caption-text">Installing ospd-openvas</span><a class="headerlink" href="#id53" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">cd $SOURCE_DIR/ospd-openvas-$OSPD_OPENVAS_VERSION</span>

<span class="go">python3 -m pip install . --prefix=$INSTALL_PREFIX --root=$INSTALL_DIR --no-warn-script-location</span>

<span class="go">sudo cp -rv $INSTALL_DIR/* /</span>

<span class="go">rm -rf $INSTALL_DIR/*</span>
</pre></div>
</div>
</div>
</section>
<section id="gvm-tools">
<h3><a class="toc-backref" href="#id98">gvm-tools</a><a class="headerlink" href="#gvm-tools" title="Permalink to this headline">¶</a></h3>
<p>The Greenbone Vulnerability Management Tools, or <em>gvm-tools</em> in short, are a
collection of tools that help with controlling the Greenbone Vulnerability
Management stack remotely.</p>
<p>Essentially, the tools aid accessing the communication protocols
<a class="reference internal" href="../glossary.html#term-GMP"><span class="xref std std-term">Greenbone Management Protocol (GMP)</span></a> and
<a class="reference internal" href="../glossary.html#term-OSP"><span class="xref std std-term">Open Scanner Protocol (OSP)</span></a>.</p>
<p><em>gvm-tools</em> are optional and not required for a functional GVM stack.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>gvm-tools</em> is released independently of the GVM framework. Therefore, the
newest version is used.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id54">
<div class="code-block-caption"><span class="caption-text">Required dependencies for gvm-tools</span><a class="headerlink" href="#id54" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y \</span>
<span class="go">  python3 \</span>
<span class="go">  python3-pip \</span>
<span class="go">  python3-setuptools \</span>
<span class="go">  python3-packaging \</span>
<span class="go">  python3-lxml \</span>
<span class="go">  python3-defusedxml \</span>
<span class="go">  python3-paramiko</span>
</pre></div>
</div>
</div>
<p>The latest version of <em>gvm-tools</em> can be installed for each user via the
standard Python installation tool <em>pip</em>.</p>
<div class="literal-block-wrapper docutils container" id="id55">
<div class="code-block-caption"><span class="caption-text">Installing gvm-tools for the current user</span><a class="headerlink" href="#id55" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">python3 -m pip install --user gvm-tools</span>
</pre></div>
</div>
</div>
<p>To install it system-wide without running <em>pip</em> as root user, the following
commands can be used:</p>
<div class="literal-block-wrapper docutils container" id="id56">
<div class="code-block-caption"><span class="caption-text">Installing gvm-tools system-wide</span><a class="headerlink" href="#id56" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">python3 -m pip install --prefix=$INSTALL_PREFIX --root=$INSTALL_DIR --no-warn-script-location gvm-tools</span>

<span class="go">sudo cp -rv $INSTALL_DIR/* /</span>

<span class="go">rm -rf $INSTALL_DIR/*</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="performing-a-system-setup-for-gvm">
<h2><a class="toc-backref" href="#id99">Performing a System Setup for GVM</a><a class="headerlink" href="#performing-a-system-setup-for-gvm" title="Permalink to this headline">¶</a></h2>
<section id="setting-up-the-redis-data-store">
<h3><a class="toc-backref" href="#id100">Setting up the Redis Data Store</a><a class="headerlink" href="#setting-up-the-redis-data-store" title="Permalink to this headline">¶</a></h3>
<p>Looking at the <a class="reference internal" href="../architecture.html"><span class="doc">GVM Architecture</span></a>, the <a class="reference external" href="https://redis.io/">Redis</a> key/value
storage is used by the scanner (<em>openvas-scanner</em> and <em>ospd-openvas</em>) for handling
the <a class="reference internal" href="../glossary.html#term-VT"><span class="xref std std-term">VT</span></a> information and scan results.</p>
<div class="literal-block-wrapper docutils container" id="id57">
<div class="code-block-caption"><span class="caption-text">Installing the Redis server</span><a class="headerlink" href="#id57" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y redis-server</span>
</pre></div>
</div>
</div>
<p>After installing the Redis server package, a specific configuration for the
<em>openvas-scanner</em> must be added.</p>
<div class="literal-block-wrapper docutils container" id="id58">
<div class="code-block-caption"><span class="caption-text">Adding configuration for running the Redis server for the scanner</span><a class="headerlink" href="#id58" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo cp $SOURCE_DIR/openvas-scanner-$GVM_VERSION/config/redis-openvas.conf /etc/redis/</span>
<span class="go">sudo chown redis:redis /etc/redis/redis-openvas.conf</span>
<span class="go">echo &quot;db_address = /run/redis-openvas/redis.sock&quot; | sudo tee -a /etc/openvas/openvas.conf</span>

<span class="gp"># </span>start redis with openvas config
<span class="go">sudo systemctl start redis-server@openvas.service</span>

<span class="gp"># </span>ensure redis with openvas config is started on every system startup
<span class="go">sudo systemctl enable redis-server@openvas.service</span>
</pre></div>
</div>
</div>
<p>Additionally the <em>gvm</em> user must be able to access the redis unix socket at
<code class="file docutils literal notranslate"><span class="pre">/run/redis-openvas/redis.sock</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id59">
<div class="code-block-caption"><span class="caption-text">Adding the <em>gvm</em> user to the redis group</span><a class="headerlink" href="#id59" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo usermod -aG redis gvm</span>
</pre></div>
</div>
</div>
</section>
<section id="adjusting-permissions">
<h3><a class="toc-backref" href="#id101">Adjusting Permissions</a><a class="headerlink" href="#adjusting-permissions" title="Permalink to this headline">¶</a></h3>
<p>For a system-wide multi-user installation, it must be ensured that the
directory permissions are set correctly and are matching the group setup.
All users of the group <em>gvm</em> should be able to read and write logs, lock files
and data like VTs.</p>
<div class="literal-block-wrapper docutils container" id="id60">
<div class="code-block-caption"><span class="caption-text">Adjusting directory permissions</span><a class="headerlink" href="#id60" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo chown -R gvm:gvm /var/lib/gvm</span>
<span class="go">sudo chown -R gvm:gvm /var/lib/openvas</span>
<span class="go">sudo chown -R gvm:gvm /var/log/gvm</span>
<span class="go">sudo chown -R gvm:gvm /run/gvm</span>

<span class="go">sudo chmod -R g+srw /var/lib/gvm</span>
<span class="go">sudo chmod -R g+srw /var/lib/openvas</span>
<span class="go">sudo chmod -R g+srw /var/log/gvm</span>
</pre></div>
</div>
</div>
<p>To allow all users of the group <em>gvm</em> access to the postgres database via the
various <em>gvmd</em> commands, the permissions of the <em>gvmd</em> executable will be adjusted
to always run as the <em>gvm</em> user and under the <em>gvm</em> group.</p>
<div class="literal-block-wrapper docutils container" id="id61">
<div class="code-block-caption"><span class="caption-text">Adjusting gvmd permissions</span><a class="headerlink" href="#id61" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo chown gvm:gvm /usr/local/sbin/gvmd</span>
<span class="go">sudo chmod 6750 /usr/local/sbin/gvmd</span>
</pre></div>
</div>
</div>
<p>Additionally the feed sync script permissions should be adjusted to only allow
<em>gvm</em> user to execute them. Otherwise the permissions of the synced files will
be broken.</p>
<div class="literal-block-wrapper docutils container" id="id62">
<div class="code-block-caption"><span class="caption-text">Adjusting feed sync script permissions</span><a class="headerlink" href="#id62" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo chown gvm:gvm /usr/local/bin/greenbone-nvt-sync</span>
<span class="go">sudo chmod 740 /usr/local/sbin/greenbone-feed-sync</span>
<span class="go">sudo chown gvm:gvm /usr/local/sbin/greenbone-*-sync</span>
<span class="go">sudo chmod 740 /usr/local/sbin/greenbone-*-sync</span>
</pre></div>
</div>
</div>
</section>
<section id="setting-up-sudo-for-scanning">
<h3><a class="toc-backref" href="#id102">Setting up <em>sudo</em> for Scanning</a><a class="headerlink" href="#setting-up-sudo-for-scanning" title="Permalink to this headline">¶</a></h3>
<p>For vulnerability scanning, it is required to have several capabilities for which
only root users are authorized, e.g., creating raw sockets. Therefore, a
configuration will be added to allow the users of the <em>gvm</em> group to run the
<em>openvas-scanner</em> application as root user via <em>sudo</em>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure that only necessary users have access to the <em>gvm</em> group. Each user
of the <em>gvm</em> group has access to can manipulate the Vulnerability Test (VT) scripts
(.nasl files). These scripts are run with root privileges and therefore can
be used for exploits. See
<a class="reference external" href="https://csal.medium.com/pentesters-tricks-local-privilege-escalation-in-openvas-fe933d7f161f">https://csal.medium.com/pentesters-tricks-local-privilege-escalation-in-openvas-fe933d7f161f</a>.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo visudo

...

# allow users of the gvm group run openvas
%gvm ALL = NOPASSWD: /usr/local/sbin/openvas
</pre></div>
</div>
</section>
<section id="setting-up-postgresql">
<h3><a class="toc-backref" href="#id103">Setting up PostgreSQL</a><a class="headerlink" href="#setting-up-postgresql" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a> database management system is
used as a central storage for user and scan information. <em>gvmd</em> connects to
a PostgreSQL database and queries the data. This database must be created
and configured.</p>
<div class="literal-block-wrapper docutils container" id="id63">
<div class="code-block-caption"><span class="caption-text">Installing the PostgreSQL server</span><a class="headerlink" href="#id63" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install -y postgresql</span>
</pre></div>
</div>
</div>
<p>If necessary the PostgreSQL database server needs to be started manually</p>
<div class="literal-block-wrapper docutils container" id="id64">
<div class="code-block-caption"><span class="caption-text">Starting the PostgreSQL database server</span><a class="headerlink" href="#id64" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo systemctl start postgresql@11-main</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id65">
<div class="code-block-caption"><span class="caption-text">Setting up PostgreSQL user and database</span><a class="headerlink" href="#id65" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo -u postgres bash</span>
<span class="go">createuser -DRS gvm</span>
<span class="go">createdb -O gvm gvmd</span>
<span class="go">exit</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id66">
<div class="code-block-caption"><span class="caption-text">Setting up database permissions and extensions</span><a class="headerlink" href="#id66" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo -u postgres bash</span>
<span class="go">psql gvmd</span>
<span class="go">create role dba with superuser noinherit;</span>
<span class="go">grant dba to gvm;</span>

<span class="go">create extension &quot;uuid-ossp&quot;;</span>
<span class="go">create extension &quot;pgcrypto&quot;;</span>
<span class="go">exit</span>
<span class="go">exit</span>
</pre></div>
</div>
</div>
</section>
<section id="setting-up-an-admin-user">
<h3><a class="toc-backref" href="#id104">Setting up an Admin User</a><a class="headerlink" href="#setting-up-an-admin-user" title="Permalink to this headline">¶</a></h3>
<p>For accessing and configuring the vulnerability data, an administrator user needs
to be created. This user can log in via the Greenbone Security Assistant (GSA)
web interface. They will have access to all data and will later be configured to
act as the <em>Feed Import Owner</em>.</p>
<div class="literal-block-wrapper docutils container" id="id67">
<div class="code-block-caption"><span class="caption-text">Creating an administrator user with generated password</span><a class="headerlink" href="#id67" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">gvmd --create-user=admin</span>
</pre></div>
</div>
</div>
<p>The new administrator user’s password is printed on success. An administrator user can
later create further users or administrators via the GSA web interface.</p>
<p>To create the administrator user with a password of your choice instead of the generated
password, the following command can be used:</p>
<div class="literal-block-wrapper docutils container" id="id68">
<div class="code-block-caption"><span class="caption-text">Creating an administrator user with provided password</span><a class="headerlink" href="#id68" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">gvmd --create-user=admin --password=&lt;password&gt;</span>
</pre></div>
</div>
</div>
<p>If the output doesn’t show</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>User created.
</pre></div>
</div>
<p>you need to look at the <code class="file docutils literal notranslate"><span class="pre">/var/log/gvm/gvmd.log</span></code> for errors.</p>
</section>
<section id="setting-the-feed-import-owner">
<h3><a class="toc-backref" href="#id105">Setting the Feed Import Owner</a><a class="headerlink" href="#setting-the-feed-import-owner" title="Permalink to this headline">¶</a></h3>
<p>Certain resources that were previously part of the gvmd source code are now
shipped via the feed. An example is the scan configuration “Full and Fast”.</p>
<p>Currently every resource needs an owner to apply the permissions and manage
the access to the resources.</p>
<p>Therefore, <em>gvmd</em> will only create these resources if a <em>Feed Import Owner</em> is
configured. Here the previously created admin user will be used as the
<em>Feed Import Owner</em>.</p>
<div class="literal-block-wrapper docutils container" id="id69">
<div class="code-block-caption"><span class="caption-text">Setting the Feed Import Owner</span><a class="headerlink" href="#id69" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">gvmd --modify-setting 78eceaec-3385-11ea-b237-28d24461215b --value `gvmd --get-users --verbose | grep admin | awk &#39;{print $2}&#39;`</span>
</pre></div>
</div>
</div>
</section>
<section id="performing-an-initial-feed-synchronization">
<h3><a class="toc-backref" href="#id106">Performing an Initial Feed Synchronization</a><a class="headerlink" href="#performing-an-initial-feed-synchronization" title="Permalink to this headline">¶</a></h3>
<p>For the actual vulnerability scanning, <a class="reference internal" href="../glossary.html#term-VT"><span class="xref std std-term">Vulnerability Test scripts</span></a>,
security information like CVEs, port lists and scan configurations are required.
All this data is provided by the <a class="reference internal" href="../glossary.html#term-GCF"><span class="xref std std-term">Greenbone Community Feed</span></a> and
needs to be download initially before starting the services.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Downloading the data during the initial synchronization may take a while
depending on the network connection and server resources.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id70">
<div class="code-block-caption"><span class="caption-text">Syncing <a class="reference internal" href="../glossary.html#term-VT"><span class="xref std std-term">VTs</span></a> processed by the scanner</span><a class="headerlink" href="#id70" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo -u gvm greenbone-nvt-sync</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The CERT feed synchronization depends on the data provided by the SCAP
feed and should be called after synchronizing the latter.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id71">
<div class="code-block-caption"><span class="caption-text">Syncing the data processed by gvmd</span><a class="headerlink" href="#id71" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo -u gvm greenbone-feed-sync --type SCAP</span>
<span class="go">sudo -u gvm greenbone-feed-sync --type CERT</span>
<span class="go">sudo -u gvm greenbone-feed-sync --type GVMD_DATA</span>
</pre></div>
</div>
</div>
</section>
<section id="starting-services-with-systemd">
<h3><a class="toc-backref" href="#id107">Starting Services with <em>Systemd</em></a><a class="headerlink" href="#starting-services-with-systemd" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://systemd.io/">Systemd</a> is used to start the daemons <em>ospd-openvas</em>,
<em>gvmd</em> and <em>gsad</em>. Therefore, service files are required.</p>
<div class="literal-block-wrapper docutils container" id="id72">
<div class="code-block-caption"><span class="caption-text">Systemd service file for ospd-openvas</span><a class="headerlink" href="#id72" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat &lt;&lt; EOF &gt; $BUILD_DIR/ospd-openvas.service
[Unit]
Description=OSPd Wrapper for the OpenVAS Scanner (ospd-openvas)
Documentation=man:ospd-openvas(8) man:openvas(8)
After=network.target networking.service redis-server@openvas.service
Wants=redis-server@openvas.service
ConditionKernelCommandLine=!recovery

[Service]
Type=forking
User=gvm
Group=gvm
RuntimeDirectory=ospd
RuntimeDirectoryMode=2775
PIDFile=/run/ospd/ospd-openvas.pid
ExecStart=/usr/local/bin/ospd-openvas --unix-socket /run/ospd/ospd-openvas.sock --pid-file /run/ospd/ospd-openvas.pid --log-file /var/log/gvm/ospd-openvas.log --lock-file-dir /var/lib/openvas --socket-mode 0o770
SuccessExitStatus=SIGKILL
Restart=always
RestartSec=60

[Install]
WantedBy=multi-user.target
EOF

sudo cp $BUILD_DIR/ospd-openvas.service /etc/systemd/system/
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id73">
<div class="code-block-caption"><span class="caption-text">Systemd service file for gvmd</span><a class="headerlink" href="#id73" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat &lt;&lt; EOF &gt; $BUILD_DIR/gvmd.service
[Unit]
Description=Greenbone Vulnerability Manager daemon (gvmd)
After=network.target networking.service postgresql.service ospd-openvas.service
Wants=postgresql.service ospd-openvas.service
Documentation=man:gvmd(8)
ConditionKernelCommandLine=!recovery

[Service]
Type=forking
User=gvm
Group=gvm
PIDFile=/run/gvm/gvmd.pid
RuntimeDirectory=gvm
RuntimeDirectoryMode=2775
ExecStart=/usr/local/sbin/gvmd --osp-vt-update=/run/ospd/ospd-openvas.sock --listen-group=gvm
Restart=always
TimeoutStopSec=10

[Install]
WantedBy=multi-user.target
EOF

sudo cp $BUILD_DIR/gvmd.service /etc/systemd/system/
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id74">
<div class="code-block-caption"><span class="caption-text">Systemd service file for gsad</span><a class="headerlink" href="#id74" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat &lt;&lt; EOF &gt; $BUILD_DIR/gsad.service
[Unit]
Description=Greenbone Security Assistant daemon (gsad)
Documentation=man:gsad(8) https://www.greenbone.net
After=network.target gvmd.service
Wants=gvmd.service

[Service]
Type=forking
User=gvm
Group=gvm
PIDFile=/run/gvm/gsad.pid
ExecStart=/usr/local/sbin/gsad --listen=127.0.0.1 --port=9392 --http-only
Restart=always
TimeoutStopSec=10

[Install]
WantedBy=multi-user.target
Alias=greenbone-security-assistant.service
EOF

sudo cp $BUILD_DIR/gsad.service /etc/systemd/system/
</pre></div>
</div>
</div>
<p>Afterwards, the services need to be activated and started.</p>
<div class="literal-block-wrapper docutils container" id="id75">
<div class="code-block-caption"><span class="caption-text">Making systemd aware of the new service files</span><a class="headerlink" href="#id75" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo systemctl daemon-reload</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id76">
<div class="code-block-caption"><span class="caption-text">Ensuring services are run at every system startup</span><a class="headerlink" href="#id76" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo systemctl enable ospd-openvas</span>
<span class="go">sudo systemctl enable gvmd</span>
<span class="go">sudo systemctl enable gsad</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please be aware, even if the <strong class="command">systemctl start</strong> commands are returning
immediately, the <strong>first startup</strong> of the services may take several minutes
or even hours!</p>
<p>At the first start the scanner needs to load all <a class="reference internal" href="../glossary.html#term-VT"><span class="xref std std-term">VTs</span></a> into Redis
and <em>gvmd</em> must process the CERT and SCAP data. <em>gvmd</em> requests all VT
information from the scanner after they are loaded by the scanner. The scan
configurations are only available if a <em>Feed Import Owner</em> is set, <em>gvmd</em> can
connect to the scanner and the VTs are fully loaded by both services.</p>
<p>Running a vulnerability scan when not all data has been loaded may lead to empty
or erroneous reports. You can check the <code class="file docutils literal notranslate"><span class="pre">/var/log/gvm/gvmd.log</span></code> file for
activity and also have a look at the SecInfo pages (for example
<span class="menuselection">SecInfo ‣ NVTs</span>).</p>
</div>
<div class="literal-block-wrapper docutils container" id="id77">
<div class="code-block-caption"><span class="caption-text">Finally starting the services</span><a class="headerlink" href="#id77" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo systemctl start ospd-openvas</span>
<span class="go">sudo systemctl start gvmd</span>
<span class="go">sudo systemctl start gsad</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id78">
<div class="code-block-caption"><span class="caption-text">Checking the status of the services</span><a class="headerlink" href="#id78" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">sudo systemctl status ospd-openvas</span>
<span class="go">sudo systemctl status gvmd</span>
<span class="go">sudo systemctl status gsad</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="starting-the-vulnerability-management">
<h2><a class="toc-backref" href="#id108">Starting the Vulnerability Management</a><a class="headerlink" href="#starting-the-vulnerability-management" title="Permalink to this headline">¶</a></h2>
<p>After the services have started and all data has been loaded, the <em>Greenbone
Security Manager</em> web interface – GSA – can be opened in the browser.</p>
<div class="literal-block-wrapper docutils container" id="id79">
<div class="code-block-caption"><span class="caption-text">Opening Greenbone Security Assistant in the browser</span><a class="headerlink" href="#id79" title="Permalink to this code">¶</a></div>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">xdg-open &quot;http://127.0.0.1:9392&quot; 2&gt;/dev/null &gt;/dev/null &amp;</span>
</pre></div>
</div>
</div>
<p>The browser will show the login page of <em>GSA</em> and after using the credentials
created in the <a class="reference external" href="#setting-up-an-admin-user">Setting Up an Admin User</a> chapter,
it is possible to start with the vulnerability scanning.</p>
<figure class="align-default" id="id80">
<img alt="Launching Greenbone Security Assistant for the first time" src="../_images/GSA.png" />
<figcaption>
<p><span class="caption-text">Greenbone Security Assistant after logging in for the first time</span><a class="headerlink" href="#id80" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="../index.html">
    <img
      class="logo"
      src="../_static/logo.svg"
      alt="Greenbone Logo"
    />
    <h1 class="logo logo-name">Greenbone Documentation</h1>
  </a>
</p>
<p class="description">
  Documentation for the Greenbone Source Edition
</p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building GVM 21.04</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li><a class="reference internal" href="#creating-a-user-and-a-group">Creating a User and a Group</a></li>
<li><a class="reference internal" href="#adjusting-the-current-user">Adjusting the Current User</a></li>
<li><a class="reference internal" href="#setting-the-path">Setting the PATH</a></li>
<li><a class="reference internal" href="#choosing-an-install-prefix">Choosing an Install Prefix</a></li>
<li><a class="reference internal" href="#creating-a-source-build-and-install-directory">Creating a Source, Build and Install Directory</a></li>
<li><a class="reference internal" href="#choosing-the-installation-source">Choosing the Installation Source</a></li>
<li><a class="reference internal" href="#installing-common-build-dependencies">Installing Common Build Dependencies</a></li>
<li><a class="reference internal" href="#importing-the-greenbone-signing-key">Importing the Greenbone Signing Key</a></li>
<li><a class="reference internal" href="#setting-the-version">Setting the version</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-and-installing-the-components">Building and Installing the Components</a><ul>
<li><a class="reference internal" href="#gvm-libs">gvm-libs</a></li>
<li><a class="reference internal" href="#gvmd">gvmd</a></li>
<li><a class="reference internal" href="#gsa">GSA</a></li>
<li><a class="reference internal" href="#openvas-smb">openvas-smb</a></li>
<li><a class="reference internal" href="#openvas-scanner">openvas-scanner</a></li>
<li><a class="reference internal" href="#ospd-openvas">ospd-openvas</a></li>
<li><a class="reference internal" href="#gvm-tools">gvm-tools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performing-a-system-setup-for-gvm">Performing a System Setup for GVM</a><ul>
<li><a class="reference internal" href="#setting-up-the-redis-data-store">Setting up the Redis Data Store</a></li>
<li><a class="reference internal" href="#adjusting-permissions">Adjusting Permissions</a></li>
<li><a class="reference internal" href="#setting-up-sudo-for-scanning">Setting up <em>sudo</em> for Scanning</a></li>
<li><a class="reference internal" href="#setting-up-postgresql">Setting up PostgreSQL</a></li>
<li><a class="reference internal" href="#setting-up-an-admin-user">Setting up an Admin User</a></li>
<li><a class="reference internal" href="#setting-the-feed-import-owner">Setting the Feed Import Owner</a></li>
<li><a class="reference internal" href="#performing-an-initial-feed-synchronization">Performing an Initial Feed Synchronization</a></li>
<li><a class="reference internal" href="#starting-services-with-systemd">Starting Services with <em>Systemd</em></a></li>
</ul>
</li>
<li><a class="reference internal" href="#starting-the-vulnerability-management">Starting the Vulnerability Management</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../background.html" title="previous chapter">Background</a></li>
      <li>Next: <a href="../gvm-20.08/index.html" title="next chapter">Building GVM 20.08</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Greenbone Networks.
      
      |
      <a href="../_sources/gvm-21.04/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/greenbone/docs" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>